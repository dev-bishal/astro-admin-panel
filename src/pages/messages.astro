---
import AdminLayout from "../Layout/AdminLayout.astro";


---

<style is:inline>
    .message-card {
        transition: all 0.3s ease;
        cursor: pointer;
    }

    .message-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .message-card.unread {
        background-color: #f0f9ff;
        border-left: 4px solid #3b82f6;
    }

    .message-card.important {
        background-color: #fef2f2;
        border-left: 4px solid #ef4444;
    }

    .message-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
    }

    .message-content.expanded {
        max-height: 500px;
    }

    .fade-in {
        animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        display: inline-block;
    }
</style>

<AdminLayout PageTitle="Messages" PageHeader="Messages" UserName="Bishal Biswas">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex lg:items-center lg:justify-between gap-4 lg:flex-row flex-col">
                <div>
                    <h1 class="text-2xl font-bold text-gray-900">Contact Messages</h1>
                    <p class="text-gray-600">Manage and respond to customer inquiries</p>
                </div>
                <div class="flex lg:items-center lg:justify-between gap-4 lg:flex-row flex-col">
                    <div class="relative">
                        <input type="text" placeholder="Search messages..."
                            class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 lg:w-64 w-full">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <i class="fas fa-search text-gray-400"></i>
                        </div>
                    </div>
                    <button
                        class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium flex items-center">
                        <i class="fas fa-envelope mr-2"></i> New Message
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="py-8">
        <!-- Stats Overview -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-sm p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-blue-100 text-blue-600">
                        <i class="fas fa-inbox text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600">Total Messages</p>
                        <h3 class="text-2xl font-bold">147</h3>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-red-100 text-red-600">
                        <i class="fas fa-envelope text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600">Unread</p>
                        <h3 class="text-2xl font-bold">12</h3>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-yellow-100 text-yellow-600">
                        <i class="fas fa-clock text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600">Pending Reply</p>
                        <h3 class="text-2xl font-bold">23</h3>
                    </div>
                </div>
            </div>
            <div class="bg-white rounded-xl shadow-sm p-6">
                <div class="flex items-center">
                    <div class="p-3 rounded-full bg-green-100 text-green-600">
                        <i class="fas fa-check-circle text-xl"></i>
                    </div>
                    <div class="ml-4">
                        <p class="text-gray-600">Replied</p>
                        <h3 class="text-2xl font-bold">89</h3>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
            <!-- Messages List -->
            <div class="lg:col-span-3">
                <div class="bg-white rounded-xl shadow-sm">
                    <!-- Filters -->
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
                            <h2 class="text-lg font-semibold text-gray-800 mb-4 sm:mb-0">All Messages</h2>
                            <div class="flex flex-wrap gap-2">
                                <button
                                    class="bg-blue-600 text-white px-3 py-1 rounded-full text-sm font-medium">All</button>
                                <button
                                    class="bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded-full text-sm font-medium hover:bg-gray-50">Unread</button>
                                <button
                                    class="bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded-full text-sm font-medium hover:bg-gray-50">Important</button>
                                <button
                                    class="bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded-full text-sm font-medium hover:bg-gray-50">Support</button>
                                <button
                                    class="bg-white border border-gray-300 text-gray-700 px-3 py-1 rounded-full text-sm font-medium hover:bg-gray-50">General</button>
                            </div>
                        </div>
                    </div>

                    <!-- Messages -->
                    <div class="divide-y divide-gray-200 max-h-[600px] overflow-y-auto">
                        <!-- Message 1 -->
                        <div class="message-card unread p-6 fade-in" data-message-id="1">
                            <div class="flex lg:items-start lg:justify-between gap-4 lg:flex-row flex-col">
                                <div class="flex items-start space-x-4 flex-1">
                                    <div class="flex-shrink-0">
                                        <div
                                            class="w-12 h-12 bg-blue-500 rounded-full flex items-center justify-center text-white font-semibold">
                                            JD
                                        </div>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center justify-between mb-2">
                                            <h3 class="font-semibold text-gray-900 truncate">John Doe</h3>
                                            <span class="text-sm text-gray-500">2 hours ago</span>
                                        </div>
                                        <div class="flex items-center space-x-3 mb-2">
                                            <span class="text-sm font-medium text-blue-600">Support Request</span>
                                            <span class="status-dot bg-blue-500"></span>
                                            <span class="text-sm text-gray-500">johndoe@example.com</span>
                                        </div>
                                        <p class="text-gray-600 text-sm mb-3">I'm having trouble accessing my account
                                            after the recent update. Can you help me reset my password?</p>
                                        <div class="flex items-center space-x-4 text-sm text-gray-500">
                                            <span class="flex items-center">
                                                <i class="fas fa-tag mr-1"></i>
                                                Technical Support
                                            </span>
                                            <span class="flex items-center">
                                                <i class="fas fa-paperclip mr-1"></i>
                                                1 attachment
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2 ml-4">
                                    <button class="text-blue-600 hover:text-blue-900 mark-read" data-message-id="1">
                                        <i class="fas fa-envelope-open"></i>
                                    </button>
                                    <button class="text-red-600 hover:text-red-900 mark-important" data-message-id="1">
                                        <i class="fas fa-star"></i>
                                    </button>
                                    <button class="text-gray-600 hover:text-gray-900 delete-message"
                                        data-message-id="1">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Expanded Content -->
                            <div class="message-content mt-4 pl-16">
                                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                    <h4 class="font-medium text-gray-800 mb-2">Original Message:</h4>
                                    <p class="text-gray-600 text-sm">Hello, I've been trying to access my account since
                                        yesterday but keep getting an error message saying "Invalid credentials." I'm
                                        sure I'm using the correct password. The issue started after your latest system
                                        update. Could you please look into this and help me regain access? I've attached
                                        a screenshot of the error message for your reference.</p>
                                    <div class="mt-3 flex space-x-2">
                                        <div class="flex items-center text-sm text-gray-500">
                                            <i class="fas fa-paperclip mr-1"></i>
                                            <span>error-screenshot.png</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- Reply Section -->
                                <div class="bg-white border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-medium text-gray-800 mb-3">Reply to John:</h4>
                                    <textarea
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 text-sm"
                                        rows="4" placeholder="Type your response here..."></textarea>
                                    <div class="flex justify-between items-center mt-3">
                                        <div class="flex space-x-2">
                                            <button class="text-gray-600 hover:text-gray-800">
                                                <i class="fas fa-paperclip"></i>
                                            </button>
                                            <button class="text-gray-600 hover:text-gray-800">
                                                <i class="fas fa-image"></i>
                                            </button>
                                        </div>
                                        <button
                                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                                            Send Reply
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Message 2 -->
                        <div class="message-card important p-6 fade-in" data-message-id="2">
                            <div class="flex lg:items-start lg:justify-between gap-4 lg:flex-row flex-col">
                                <div class="flex items-start space-x-4 flex-1">
                                    <div class="flex-shrink-0">
                                        <div
                                            class="w-12 h-12 bg-green-500 rounded-full flex items-center justify-center text-white font-semibold">
                                            SJ
                                        </div>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center justify-between mb-2">
                                            <h3 class="font-semibold text-gray-900 truncate">Sarah Johnson</h3>
                                            <span class="text-sm text-gray-500">5 hours ago</span>
                                        </div>
                                        <div class="flex items-center space-x-3 mb-2">
                                            <span class="text-sm font-medium text-red-600">Urgent: Billing Issue</span>
                                            <span class="status-dot bg-red-500"></span>
                                            <span class="text-sm text-gray-500">sarahj@company.com</span>
                                        </div>
                                        <p class="text-gray-600 text-sm mb-3">I was charged twice for my subscription
                                            this month. Please refund the duplicate charge immediately.</p>
                                        <div class="flex items-center space-x-4 text-sm text-gray-500">
                                            <span class="flex items-center">
                                                <i class="fas fa-tag mr-1"></i>
                                                Billing
                                            </span>
                                            <span class="flex items-center text-green-600">
                                                <i class="fas fa-check-circle mr-1"></i>
                                                Replied
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2 ml-4">
                                    <button class="text-blue-600 hover:text-blue-900 mark-read" data-message-id="2">
                                        <i class="fas fa-envelope"></i>
                                    </button>
                                    <button class="text-yellow-600 hover:text-yellow-900 mark-important"
                                        data-message-id="2">
                                        <i class="fas fa-star"></i>
                                    </button>
                                    <button class="text-gray-600 hover:text-gray-900 delete-message"
                                        data-message-id="2">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Message 3 -->
                        <div class="message-card p-6 fade-in" data-message-id="3">
                            <div class="flex lg:items-start lg:justify-between gap-4 lg:flex-row flex-col">
                                <div class="flex items-start space-x-4 flex-1">
                                    <div class="flex-shrink-0">
                                        <div
                                            class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white font-semibold">
                                            MR
                                        </div>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center justify-between mb-2">
                                            <h3 class="font-semibold text-gray-900 truncate">Mike Rodriguez</h3>
                                            <span class="text-sm text-gray-500">1 day ago</span>
                                        </div>
                                        <div class="flex items-center space-x-3 mb-2">
                                            <span class="text-sm font-medium text-gray-600">Feature Request</span>
                                            <span class="status-dot bg-gray-400"></span>
                                            <span class="text-sm text-gray-500">mike.rodriguez@email.com</span>
                                        </div>
                                        <p class="text-gray-600 text-sm mb-3">I'd like to suggest adding dark mode to
                                            your application. Many users would appreciate this feature.</p>
                                        <div class="flex items-center space-x-4 text-sm text-gray-500">
                                            <span class="flex items-center">
                                                <i class="fas fa-tag mr-1"></i>
                                                Feature Request
                                            </span>
                                            <span class="flex items-center text-yellow-600">
                                                <i class="fas fa-clock mr-1"></i>
                                                Pending
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2 ml-4">
                                    <button class="text-blue-600 hover:text-blue-900 mark-read" data-message-id="3">
                                        <i class="fas fa-envelope"></i>
                                    </button>
                                    <button class="text-gray-600 hover:text-yellow-900 mark-important"
                                        data-message-id="3">
                                        <i class="far fa-star"></i>
                                    </button>
                                    <button class="text-gray-600 hover:text-gray-900 delete-message"
                                        data-message-id="3">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Pagination -->
                    <div class="px-6 py-4 border-t border-gray-200 flex items-center justify-between">
                        <div class="text-sm text-gray-700">
                            Showing 1 to 3 of 147 messages
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-3 py-1 rounded border border-gray-300 text-gray-600 hover:bg-gray-50">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="px-3 py-1 rounded border border-blue-500 bg-blue-50 text-blue-600">1</button>
                            <button
                                class="px-3 py-1 rounded border border-gray-300 text-gray-600 hover:bg-gray-50">2</button>
                            <button
                                class="px-3 py-1 rounded border border-gray-300 text-gray-600 hover:bg-gray-50">3</button>
                            <button class="px-3 py-1 rounded border border-gray-300 text-gray-600 hover:bg-gray-50">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6">
                <!-- Quick Actions -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Quick Actions</h3>
                    <div class="space-y-3">
                        <button
                            class="w-full bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg text-sm font-medium flex items-center justify-center">
                            <i class="fas fa-reply mr-2"></i> Quick Reply
                        </button>
                        <button
                            class="w-full bg-white border border-gray-300 text-gray-700 py-2 px-4 rounded-lg text-sm font-medium hover:bg-gray-50 flex items-center justify-center">
                            <i class="fas fa-download mr-2"></i> Export Messages
                        </button>
                        <button
                            class="w-full bg-white border border-gray-300 text-gray-700 py-2 px-4 rounded-lg text-sm font-medium hover:bg-gray-50 flex items-center justify-center">
                            <i class="fas fa-archive mr-2"></i> Archive Selected
                        </button>
                    </div>
                </div>

                <!-- Message Statistics -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Message Types</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Support</span>
                            <span class="text-sm font-medium text-gray-800">45%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full" style="width: 45%"></div>
                        </div>

                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Billing</span>
                            <span class="text-sm font-medium text-gray-800">25%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-red-600 h-2 rounded-full" style="width: 25%"></div>
                        </div>

                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">General</span>
                            <span class="text-sm font-medium text-gray-800">20%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-green-600 h-2 rounded-full" style="width: 20%"></div>
                        </div>

                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Feature Requests</span>
                            <span class="text-sm font-medium text-gray-800">10%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            <div class="bg-purple-600 h-2 rounded-full" style="width: 10%"></div>
                        </div>
                    </div>
                </div>

                <!-- Response Templates -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Quick Responses</h3>
                    <div class="space-y-2">
                        <button
                            class="w-full text-left text-sm text-gray-600 hover:text-blue-600 p-2 rounded hover:bg-blue-50">
                            Thank you for your inquiry...
                        </button>
                        <button
                            class="w-full text-left text-sm text-gray-600 hover:text-blue-600 p-2 rounded hover:bg-blue-50">
                            We're looking into this issue...
                        </button>
                        <button
                            class="w-full text-left text-sm text-gray-600 hover:text-blue-600 p-2 rounded hover:bg-blue-50">
                            Your feature request has been noted...
                        </button>
                        <button
                            class="w-full text-left text-sm text-gray-600 hover:text-blue-600 p-2 rounded hover:bg-blue-50">
                            Billing issue resolved...
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script is:inline>
        document.addEventListener('DOMContentLoaded', function () {
            // Toggle message expansion
            document.querySelectorAll('.message-card').forEach(card => {
                card.addEventListener('click', function (e) {
                    if (!e.target.closest('button')) {
                        const content = this.querySelector('.message-content');
                        content.classList.toggle('expanded');
                    }
                });
            });

            // Mark as read/unread
            document.querySelectorAll('.mark-read').forEach(button => {
                button.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const messageId = this.getAttribute('data-message-id');
                    const messageCard = document.querySelector(`[data-message-id="${messageId}"]`);
                    messageCard.classList.toggle('unread');

                    const icon = this.querySelector('i');
                    if (messageCard.classList.contains('unread')) {
                        icon.className = 'fas fa-envelope-open';
                    } else {
                        icon.className = 'fas fa-envelope';
                    }

                    // In real app, update status via API
                    console.log(`Message ${messageId} marked as read`);
                });
            });

            // Mark as important
            document.querySelectorAll('.mark-important').forEach(button => {
                button.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const messageId = this.getAttribute('data-message-id');
                    const messageCard = document.querySelector(`[data-message-id="${messageId}"]`);
                    messageCard.classList.toggle('important');

                    const icon = this.querySelector('i');
                    if (messageCard.classList.contains('important')) {
                        icon.className = 'fas fa-star';
                        this.classList.add('text-yellow-600');
                    } else {
                        icon.className = 'far fa-star';
                        this.classList.remove('text-yellow-600');
                    }

                    // In real app, update status via API
                    console.log(`Message ${messageId} marked as important`);
                });
            });

            // Delete message
            document.querySelectorAll('.delete-message').forEach(button => {
                button.addEventListener('click', function (e) {
                    e.stopPropagation();
                    const messageId = this.getAttribute('data-message-id');

                    if (confirm('Are you sure you want to delete this message?')) {
                        const messageCard = document.querySelector(`[data-message-id="${messageId}"]`);
                        messageCard.style.opacity = '0';
                        messageCard.style.transform = 'translateX(-100%)';

                        setTimeout(() => {
                            messageCard.remove();
                            // In real app, delete via API
                            console.log(`Message ${messageId} deleted`);
                        }, 300);
                    }
                });
            });

            // Filter buttons
            document.querySelectorAll('.flex-wrap button').forEach(button => {
                button.addEventListener('click', function () {
                    // Remove active state from all buttons
                    document.querySelectorAll('.flex-wrap button').forEach(btn => {
                        btn.classList.remove('bg-blue-600', 'text-white');
                        btn.classList.add('bg-white', 'border', 'border-gray-300', 'text-gray-700');
                    });

                    // Add active state to clicked button
                    this.classList.remove('bg-white', 'border', 'border-gray-300', 'text-gray-700');
                    this.classList.add('bg-blue-600', 'text-white');

                    // In real app, filter messages based on selection
                    console.log(`Filter: ${this.textContent}`);
                });
            });

            // Quick response templates
            document.querySelectorAll('.bg-white.rounded-xl.shadow-sm.p-6 .space-y-2 button').forEach(button => {
                button.addEventListener('click', function () {
                    const responseText = this.textContent;
                    const textarea = document.querySelector('textarea');
                    if (textarea) {
                        textarea.value = responseText;
                        textarea.focus();
                    }
                });
            });
        });
    </script>
</AdminLayout>